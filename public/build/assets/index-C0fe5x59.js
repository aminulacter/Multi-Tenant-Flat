import{d as N,r as a,p as j,c as B,w as b,b as w,e as t,j as i,k as g,u as v,h as M,l as E,f,o as l,t as m,i as D,F as R,s as z,x as V,m as y}from"./app-C1gjP-sn.js";import{d as I,e as L,_ as O}from"./AppLayout.vue_vue_type_script_setup_true_lang-BxnW7pDE.js";import{d as H}from"./index-DUMdsY2H.js";import{W}from"./style-B6TQ_5ut.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-lqOkEa73.js";import"./useForwardExpose-BdW8TFuC.js";import"./VisuallyHidden-COE-oCfJ.js";import"./RovingFocusGroup-CNXrAHiD.js";import"./useArrowNavigation-C6Y-ieo6.js";import"./createLucideIcon-DiNYG7n8.js";const U={class:"py-12"},q={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},G={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},J={class:"p-6 text-gray-900"},K={class:"flex justify-between items-center mb-6"},Q={key:0,class:"text-center py-4"},X={class:"flex items-center gap-2"},Y=["onClick"],Z=["onClick"],ee=["onClick"],te={key:0,class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"},oe={class:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white"},se={class:"mt-3"},ae={key:0,class:"mb-4 p-3 bg-gray-50 rounded-md"},le={class:"text-sm text-gray-600"},ne={class:"mb-4"},re=["disabled"],ie={value:""},ue=["value"],de={class:"flex items-center justify-end space-x-3"},ce=["disabled"],ke=N({__name:"index",setup(ge){const S=[{title:"Dashboard",href:H().url},{title:"Flats",href:I().url}],T=[{field:"id",title:"ID",sort:!0},{field:"name",title:"Flat Name",sort:!0},{field:"building_name",title:"Building",sort:!0},{field:"tenant_name",title:"Tenant",sort:!0},{field:"house_owner_name",title:"House Owner",sort:!0},{field:"actions",title:"Actions",sort:!1}],k=a([]),p=a(!0),u=a({total:0,per_page:10,current_page:1,last_page:1,from:0,to:0}),x=a(!1),n=a(null),_=a([]),r=a(null),h=a(!1),d=async(s=1)=>{p.value=!0;try{const o=await(await fetch(`/getflats?page=${s}`)).json();k.value=o.data,u.value=o.pagination}catch(e){console.error("Error fetching flats:",e)}finally{p.value=!1}},F=s=>{confirm("Are you sure you want to delete this flat?")&&y.delete(`/flats/${s.id}`,{onSuccess:()=>{d()},onError:e=>{console.error("Error deleting flat:",e)}})},P=async s=>{n.value=s,r.value=null,h.value=!0,x.value=!0;try{const o=await(await fetch(`/getavailabletenants?house_owner_id=${s.house_owner_id}`)).json();_.value=o,o.length===0&&(alert("No available tenants to allocate for this house owner."),c())}catch(e){console.error("Error fetching available tenants:",e),alert("Error fetching available tenants."),c()}finally{h.value=!1}},c=()=>{x.value=!1,n.value=null,_.value=[],r.value=null},$=()=>{if(!r.value){alert("Please select a tenant.");return}y.post(`/flats/${n.value.id}/allocate-tenant`,{tenant_id:r.value},{onSuccess:()=>{d(),c()},onError:s=>{console.error("Error allocating tenant:",s)}})},A=s=>{confirm("Are you sure you want to remove the tenant from this flat?")&&y.delete(`/flats/${s.id}/remove-tenant`,{onSuccess:()=>{d()},onError:e=>{console.error("Error removing tenant:",e)}})};return j(()=>{d()}),(s,e)=>(l(),B(O,{breadcrumbs:S},{default:b(()=>[w(v(M),{title:"Flats"}),t("div",U,[t("div",q,[t("div",G,[t("div",J,[t("div",K,[e[3]||(e[3]=t("h1",{class:"text-2xl font-bold text-gray-900"},"Flats",-1)),w(v(E),{href:v(L)().url,class:"bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md transition-colors"},{default:b(()=>[...e[2]||(e[2]=[f(" Create Flat ",-1)])]),_:1},8,["href"])]),p.value?(l(),i("div",Q," Loading flats... ")):g("",!0),w(v(W),{rows:k.value,columns:T,loading:p.value,sortable:!0,searchable:!0,pageSize:u.value.per_page,pageSizeOptions:[10,20,50,100],showPageSize:!0,showPageNumber:!0,showPageInfo:!0,showSearch:!0,showEntries:!0,showPagination:!0,showRefresh:!0,showExport:!0,showImport:!1,showColumnToggle:!0,showRowSelect:!0,showRowExpand:!1,totalRows:u.value.total,currentPage:u.value.current_page,lastPage:u.value.last_page,onPageChange:e[0]||(e[0]=o=>d(o))},{actions:b(o=>[t("div",X,[w(v(E),{href:`/flats/${o.value.id}/edit`,class:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm transition-colors"},{default:b(()=>[...e[4]||(e[4]=[f("Edit",-1)])]),_:1},8,["href"]),o.value.tenant_id?g("",!0):(l(),i("button",{key:0,onClick:C=>P(o.value),class:"bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm transition-colors"},"Allocate Tenant",8,Y)),o.value.tenant_id?(l(),i("button",{key:1,onClick:C=>A(o.value),class:"bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-1 rounded text-sm transition-colors"},"Remove Tenant",8,Z)):g("",!0),t("button",{onClick:C=>F(o.value),class:"bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm transition-colors"},"Delete",8,ee)])]),_:1},8,["rows","loading","pageSize","totalRows","currentPage","lastPage"])])])])]),x.value?(l(),i("div",te,[t("div",oe,[t("div",se,[t("div",{class:"flex items-center justify-between mb-4"},[e[6]||(e[6]=t("h3",{class:"text-lg font-medium text-gray-900"},"Allocate Tenant",-1)),t("button",{onClick:c,class:"text-gray-400 hover:text-gray-600"},[...e[5]||(e[5]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),n.value?(l(),i("div",ae,[e[10]||(e[10]=t("h4",{class:"font-medium text-gray-900 mb-2"},"Flat Details",-1)),t("div",le,[t("p",null,[e[7]||(e[7]=t("strong",null,"Flat Name:",-1)),f(" "+m(n.value.name),1)]),t("p",null,[e[8]||(e[8]=t("strong",null,"Building:",-1)),f(" "+m(n.value.building_name),1)]),t("p",null,[e[9]||(e[9]=t("strong",null,"House Owner:",-1)),f(" "+m(n.value.house_owner_name),1)])])])):g("",!0),t("div",ne,[e[11]||(e[11]=t("label",{for:"tenant-select",class:"block text-sm font-medium text-gray-700 mb-2"}," Select Tenant ",-1)),D(t("select",{id:"tenant-select","onUpdate:modelValue":e[1]||(e[1]=o=>r.value=o),class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",disabled:h.value},[t("option",ie,m(h.value?"Loading tenants...":"Select a tenant"),1),(l(!0),i(R,null,z(_.value,o=>(l(),i("option",{key:o.id,value:o.id},m(o.name),9,ue))),128))],8,re),[[V,r.value]])]),t("div",de,[t("button",{onClick:c,class:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 transition-colors"}," Cancel "),t("button",{onClick:$,disabled:!r.value,class:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors"}," Allocate Tenant ",8,ce)])])])])):g("",!0)]),_:1}))}});export{ke as default};
